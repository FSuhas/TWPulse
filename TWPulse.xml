<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.blizzard.com/wow/ui/..\FrameXML\UI.xsd">
    
    <Script file="TWPulse.lua"/>

    <!-- Template pour les icônes animées -->
    <Frame name="TWPulseTemplate" virtual="true">
        <Size>
            <AbsDimension x="125" y="125"/>
        </Size>
        <Anchors>
            <Anchor point="CENTER"/>
        </Anchors>
        <Layers>
            <Layer level="BACKGROUND">
                <Texture name="$parentIcon">
                    <Size>
                        <AbsDimension x="125" y="125"/>
                    </Size>
                    <Anchors>
                        <Anchor point="CENTER">
                            <Offset>
                                <AbsDimension x="0" y="0"/>
                            </Offset>
                        </Anchor>
                    </Anchors>
                </Texture>
            </Layer>
        </Layers>
    </Frame>

    <!-- Frame principale du pulse -->
    <Frame name="TWPulse" hidden="true" toplevel="true"
           parent="UIParent" movable="true" enableMouse="false" resizable="true">
        <Size>
            <AbsDimension x="125" y="125"/>
        </Size>
        <Anchors>
            <Anchor point="CENTER"/>
        </Anchors>
        <Frames>
            <!-- Carré de déverrouillage -->
            <Frame name="$parentUnlock" hidden="true">
                <Size>
                    <AbsDimension x="125" y="125"/>
                </Size>
                <Anchors>
                    <Anchor point="CENTER"/>
                </Anchors>
                <Backdrop edgeFile="Interface\DialogFrame\UI-DialogBox-Border"
                          bgFile="Interface\DialogFrame\UI-DialogBox-Background"
                          tile="false">
                    <BackgroundInsets>
                        <AbsInset left="11" right="12" top="12" bottom="11"/>
                    </BackgroundInsets>
                    <TileSize>
                        <AbsValue val="32"/>
                    </TileSize>
                    <EdgeSize>
                        <AbsValue val="32"/>
                    </EdgeSize>
                </Backdrop>
            </Frame>
        </Frames>
        <Scripts>
            <OnLoad>
                this:RegisterForDrag("LeftButton");
                this:SetMovable(1);
                this:SetUserPlaced(true);

                -- Initialisation taille depuis SaveVariable
                if TWPB_P then
                    this:SetWidth(TWPB_P)
                    this:SetHeight(TWPB_P)
                    if this.Unlock then
                        this.Unlock:SetWidth(TWPB_P)
                        this.Unlock:SetHeight(TWPB_P)
                    end
                end
            </OnLoad>
            <OnDragStart>
                this:StartMoving();
                this.isMoving = true;
            </OnDragStart>
            <OnDragStop>
                this:StopMovingOrSizing();
                this.isMoving = false;
            </OnDragStop>
        </Scripts>
    </Frame>
</Ui>
